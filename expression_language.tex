We define an expression language which will allow us to write and type-check recurrence relations such as 
those described by Karp. The syntax of this language is mostly analogous to PCF, with one key exception: instead of a 
$\texttt{nat}$ type, we have a $\texttt{real}$ type, as this is the domain of the functions Karp discusses. \\ 
\[
\begin{array}{rcl}
\tau &::=& \texttt{real} \mid \texttt{bool} \mid \tau \times \tau \mid \tau \rightarrow \tau \\
e &::=& x  \mid \texttt{0} \mid \texttt{1} \mid \texttt{2} \mid \dotsc \mid \lambda x.e \mid e \ e \mid e + e \mid e - e \mid  e  *  e \mid e / e \mid \texttt{true} \mid \texttt{false} \mid \\
  && e  =  e \mid e < e \mid e > e \ | e \leq e \mid e \geq e \mid 
     if \ e \ then \ e \ else \ e \mid \texttt{fix} (\lambda f.\lambda x.e) \\
v &::=& x  \mid \texttt{0} \mid \texttt{1} \mid \texttt{2} \mid \dotsc \mid \lambda x.e \mid \texttt{true} \mid \texttt{false} \mid \texttt{fix} (\lambda f.\lambda x.e)
\end{array}
\]

\section{Type System}

\[
\begin{array}{lr}
\dfrac{}{\Gamma \vdash \texttt{0}: \texttt{real}}, \ \ \dfrac{}{\Gamma \vdash \texttt{1}: \texttt{real}}, \ldots \\
\dfrac{}{\Gamma \vdash \texttt{true} : \texttt{bool}}, \ \ \dfrac{}{\Gamma \vdash \texttt{false} : \texttt{bool}} \\ \\ \\
\dfrac{x : \tau \in \Gamma}{\Gamma \vdash x : \tau } \\ \\ \\
\dfrac{\Gamma, x : \sigma \vdash e : \tau}{\Gamma \vdash \lambda (x : \sigma).e : \sigma \rightarrow \tau } \\ \\ \\ 
\dfrac{\Gamma \vdash e_1: \sigma \rightarrow \tau \ \ \ \Gamma \vdash e_2 : \sigma}{\Gamma \vdash e_1 \ e_2 : \tau} \\ \\ \\
\dfrac{\Gamma \vdash e_1 : \texttt{real} \ \ \ \Gamma \vdash e_2 : \texttt{real}}{\Gamma \vdash e_1 \circ e_2 : \texttt{real}}
, \circ \in \{+,-,*,/\} \\ \\ \\
\dfrac{\Gamma \vdash e_1 : \texttt{real} \ \ \ \Gamma \vdash e_2 : \texttt{real}}{\Gamma \vdash e_1 \circ e_2 : \texttt{bool}}
, \circ \in \{=, <, >, \geq, \leq\} \\ \\ \\
\dfrac{\Gamma \vdash e_1 : \texttt{bool} \ \ \ \Gamma \vdash e_2 : \tau \ \ \ \Gamma \vdash e_3 : \tau}
{\Gamma \vdash \ifelse{e_1}{e_2}{e_3} : \tau} \\ \\ \\
\dfrac{\Gamma \vdash \lambda f. \lambda x.e : (\tau \rightarrow \tau) \rightarrow (\tau \rightarrow \tau)}
{\Gamma \vdash \texttt{fix}(\lambda f. \lambda x.e) : \tau \rightarrow \tau} \\ \\ \\ 
\end{array}
\]

\section{Equational Semantics}
\[
\begin{array}{lr}
e = e \\ \\
\texttt{0} + \texttt{0} = \texttt{0}, \ \texttt{0} + \texttt{1} = 1, \ldots, \ \texttt{3} + \texttt{5} = \texttt{8}, \ldots  \\
\text{equivalent rules for } -, \ * \text{, and } /\text{ operations.}
\\ \\
(n =n) = \texttt{true} \\ (n=m) = \texttt{false}\text{, provided } n, \ m \text{ distinct numerals.}\\ \\ 
\ifelse{\texttt{ true }}{e_1}{e_2} = e_1 \\
\ifelse{\texttt{ false }}{e_1}{e_2} = e_2 \\ \\ 
\lambda x.e = \lambda y.e\{x \mapsto y \}, \text{provided } y \text{ not free in } e. \\ \\ \\
\lambda x.e_1 \ e_2 = e_1\{x \mapsto e_2\} \\
\texttt{fix}(\lambda f. \lambda x.e) = (\lambda x.e)\{f \mapsto \texttt{fix}(\lambda f.\lambda x.e)\}
\end{array}
\]

\section{Denotational Semantics}
The denotational semantics of our expression language is mostly standard, with types interpreting to flat-ordered sets. Again, 
the exception is the $\texttt{real}$ type, which interprets to the non-negative reals, with an additional element $+\infty$ such 
that for $\forall x \in R$, $x<+\infty$. (Need more explanation of this here).
 \begin{align*}
\llbracket \texttt{real} \rrbracket &= \R_{[0, +\infty]} = \{x \in \R \ | \ x \geq 0\} \cup \{+\infty\} \\
 \llbracket \texttt{bool} \rrbracket &= {\{true, false\}}_{\perp} \\
 \llbracket \tau \times \sigma \rrbracket &= \llbracket \tau \rrbracket \times \llbracket \sigma \rrbracket  \\
 \llbracket \tau \rightarrow \sigma \rrbracket &= \{f: \llbracket \tau \rrbracket \rightarrow \llbracket \sigma \rrbracket \ : 
 \ f \text{ is continuous}\}
 \end{align*}
\begin{align*}
 \llbracket \texttt{0} \rrbracket\eta &= 0, \  \llbracket \texttt{1} \rrbracket\eta = 1, \ \ldots \\
  \llbracket x : \tau \rrbracket\eta &= \eta(x) \\
  \llbracket \lambda (x : \tau) . (e : \sigma) \rrbracket\eta &= f : \llbracket \tau \rrbracket \rightarrow \llbracket \sigma \rrbracket
\text{ s.t. } \forall d \in \llbracket \tau \rrbracket, f(d) = \llbracket e \rrbracket\eta\{ x \mapsto d \} \\
 \llbracket e_1 \ e_2 \rrbracket \eta &= \llbracket e_1 \rrbracket\eta ( \llbracket e_2 \rrbracket\eta ) \\
 \llbracket e_1 + e_2 \rrbracket\eta &= \llbracket e_1 \rrbracket\eta + \llbracket e_2 \rrbracket\eta \\
 \llbracket e_1 - e_2 \rrbracket\eta &= \llbracket e_1 \rrbracket\eta - \llbracket e_2 \rrbracket\eta \\
 \llbracket e_1 * e_2 \rrbracket\eta &= \llbracket e_1 \rrbracket\eta * \llbracket e_2 \rrbracket\eta \\
  \llbracket e_1 / e_2 \rrbracket\eta &= \llbracket e_1 \rrbracket\eta / \llbracket e_2 \rrbracket\eta \\
  \llbracket \texttt{true} \rrbracket\eta &= true, \ \llbracket \texttt{false} \rrbracket\eta = false \\
 \llbracket e_1 = e_2 \rrbracket\eta &= 
 \begin{cases} 
      true \text{ if } (\llbracket e_1 \rrbracket\eta = \llbracket e_2 \rrbracket\eta \neq \perp) \\
      false \text{  if } (\llbracket e_1 \rrbracket\eta \neq \llbracket e_2\rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp)\\
      \perp \text{ otherwise}
   \end{cases}
 \\
  \llbracket e_1 < e_2 \rrbracket\eta &= 
 \begin{cases} 
      true \text{ if } (\llbracket e_1 \rrbracket\eta < \llbracket e_2 \rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp) \\
      false \text{  if } (\llbracket e_1 \rrbracket\eta \geq \llbracket e_2\rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp)\\
      \perp \text{ otherwise}
   \end{cases}
 \\
  \llbracket e_1 > e_2 \rrbracket\eta &= 
 \begin{cases} 
      true \text{ if } (\llbracket e_1 \rrbracket\eta > \llbracket e_2 \rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp) \\
      false \text{  if } (\llbracket e_1 \rrbracket\eta \leq \llbracket e_2\rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp)\\
      \perp \text{ otherwise}
   \end{cases}
 \\
  \llbracket e_1 \leq e_2 \rrbracket\eta &= 
 \begin{cases} 
      true \text{ if } (\llbracket e_1 \rrbracket\eta \leq \llbracket e_2 \rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp) \\
      false \text{  if } (\llbracket e_1 \rrbracket\eta > \llbracket e_2\rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp)\\
      \perp \text{ otherwise}
   \end{cases}
 \\
  \llbracket e_1 \geq e_2 \rrbracket\eta &= 
 \begin{cases} 
      true \text{ if } (\llbracket e_1 \rrbracket\eta \geq \llbracket e_2 \rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp) \\
      false \text{  if } (\llbracket e_1 \rrbracket\eta < \llbracket e_2\rrbracket\eta, \llbracket e_1 \rrbracket\eta \neq \perp, \llbracket e_2 \rrbracket\eta \neq \perp)\\
      \perp \text{ otherwise}
   \end{cases}
 \\
  \llbracket \ifelse{e_1}{e_2}{e_3} \rrbracket \eta &= 
 \begin{cases} 
      \llbracket e_2 \rrbracket\eta \text{ if } \llbracket e_1 \rrbracket\eta = true \\
      \llbracket e_3 \rrbracket\eta \text{ if } \llbracket e_1 \rrbracket\eta = false \\
      \perp \text{      otherwise} \\
   \end{cases}
  \\
   \llbracket  \texttt{fix} (\lambda f.\lambda x.e) \rrbracket\eta &= fix\llbracket \lambda f.\lambda x.e \rrbracket\eta \
 \text{, where } fix \text{ assigns the least fixed point} \\ 
 &\text{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to continuous functions} \\
 \end{align*}
\begin{thm}
For all types $\tau, \ \llbracket \tau \rrbracket$ is a CPO --- that is, $\llbracket \tau \rrbracket$ is an ordered 
set with a bottom element, such that for $\forall C \subset \llbracket \tau \rrbracket$, if  $C$ is a chain, then $C$ has a least 
upper bound in $\llbracket \tau \rrbracket$. \\
\end{thm}
\begin{proof}
by induction on the structure of $\tau$. \\
\emph{Base Cases: }
\begin{itemize}
\item $\tau = \texttt{real}$ \\ \\
In this case, $\llbracket \tau \rrbracket = \extR$. Then $0$ is a bottom element of $\llbracket \tau \rrbracket$, and for 
any chain $C \subset \R, \ C$ is bounded by $+\infty$, so by the least upper bound property $C$ has a least upper bound in 
$\llbracket \tau \rrbracket$.
\item $\tau = \texttt{bool}$ \\ \\
In this case, $\llbracket \tau \rrbracket$ is set with flat ordering, and is thus a CPO. \\ 
\end{itemize}
\emph{Inductive Cases: }
\begin{itemize}
\item $\tau = \tau_1 \times \tau_2$ \\ \\
Note $\llbracket \tau \rrbracket = \llbracket \tau_1 \rrbracket \times \llbracket \tau_2 \rrbracket$. By inductive hypothesis,
$\llbracket \tau_1 \rrbracket$ and $\llbracket \tau_2 \rrbracket$ are CPO's, and thus have bottom elements $\perp_1$ and $
\perp_2$, respectively. Thus $(\perp_1, \perp_2)$ is a bottom element of $\tau$. 

Let $C \subset \llbracket \tau \rrbracket$ be a
chain, and define
\begin{center}
$C_1 = \{x \in \llbracket \tau_1 \rrbracket : (x,y) \in C\},$ \\
$C_2 = \{ y \in \llbracket \tau_2 \rrbracket: (x,y) \in C\}$. \\ 
\end{center}
Then $C_1 \subset \llbracket \tau_1 \rrbracket$ and $C_2 \subset \llbracket \tau_2 \rrbracket$ are chains, so $\bigvee C_1$
and $\bigvee C_2$ exist. We claim that $(\bigvee C_1, \bigvee C_2)$ is the least upper bound of $C$. 

Let $(c_1, c_2) \in C$. Then $c_1 \in C_1$ and $c_2 \in C_2$, so $c_1 \leq \bigvee C_1$ and $c_2 \leq \bigvee C_2$. Thus, 
$(c_1, c_2) \leq (\bigvee C_1, \bigvee C_2)$, so $(\bigvee C_1, \bigvee C_2)$ is an upper bound of $C$.

Now let $(x,y) \in \llbracket \tau \rrbracket$ be an upper bound of C. Then $\forall c_1 \in C_1, \ c_1 \leq x$, so $x$ is an upper 
bound of $C_1$. Similarly, $y$ is an upper bound of $C_2$. Thus, it must be that $\bigvee C_1 \leq x$ and 
$\bigvee C_2 \leq y$, so $(\bigvee C_1, \bigvee C_2) \leq (x,y)$. Therefore, $(\bigvee C_1, \bigvee C_2)$ is the least upper
bound of $C$.
 
See, then, that by definition $\llbracket \tau \rrbracket$ is a CPO.

\item $\tau = \tau_1 \rightarrow \tau_2$ \\ \\
Note $\llbracket \tau \rrbracket = \{f : \llbracket \tau_1 \rrbracket \rightarrow \llbracket \tau_2 \rrbracket : f \text{ is continuous}\}
$. By inductive hypothesis, $\llbracket \tau_1 \rrbracket$ and $\llbracket \tau_2 \rrbracket$ are CPO's, and thus have bottom
elements $\perp_1$ and $\perp_2$, respectively. Let $\perp: \llbracket \tau_1 \rrbracket \rightarrow \llbracket \tau_2 
\rrbracket$ be a function such that, for $\forall x \in \llbracket \tau_1 \rrbracket, \ \perp(x) = \perp_2$. See, then, that 
$\perp$ is a continuous function that is less than or equal to every function in $\llbracket \tau \rrbracket$ (using pointwise
ordering), so $\perp$ is the bottom element of $\llbracket \tau \rrbracket$.  

Let $C \subset \llbracket \tau \rrbracket$ be a 
chain, and consider that for $\forall x \in \tau_1, \{f(x) : f \in C\}$ is a chain in $\llbracket \tau_2 \rrbracket$. Call this set $F_x$,
and note that $\bigvee F_x$ exists. We define a function $g: \llbracket \tau_1 \rrbracket \rightarrow \llbracket \tau_2 \rrbracket$ 
such that $\forall x \in \llbracket \tau_1 \rrbracket, \ g(x) = \bigvee F_x$. We claim that $g = \bigvee C$. 

Let $f \in C$, and note that for $\forall x \in \llbracket \tau_1 \rrbracket, \ f(x) \leq \bigvee F_x =g(x)$. Then $g$ is an upper bound of $C$.

Now let $\rho \in \llbracket \tau \rrbracket$ be an upper bound of $C$. Then for $\forall x \in \llbracket \tau_1 \rrbracket, \forall f \in C, \ f(x) \leq \rho(x)$, so $\rho(x)$ is an upper bound of $\{f(x) : f \in C\} = F_x$. Thus $\rho(x) \geq F_x = g(x), \ \forall x \in 
\llbracket \tau_1 \rrbracket$, so $g \leq \rho$. Therefore, g is the least upper bound of $C$.

See, then, that by definition $\llbracket \tau \rrbracket$ is a CPO. \\
\end{itemize} 
\end{proof}
%
\begin{thm} 
(Need to update these proofs)
For all expressions $e$ and environments $\Gamma$,
\begin{enumerate}
\item For all $\Gamma\vdash e : \tau$ and all $\Gamma$-environments~$\eta$,
$\tmden{\typing\Gamma e\tau}\eta\in\tyden{\tau}$.
\item For all chains $a_0\leq a_1\leq\dotsb$,
$\tmden{\typing\Gamma e\tau}{\extend\eta x {\bigvee_i a_i}} =
\bigvee_i\tmden{\typing\Gamma e\tau}{\extend\eta x {a_i}}$.
\end{enumerate}
\end{thm}
\begin{proof}
by induction on the structure of $e$. For all cases, let $\{ \eta_i \}^{\infty}_{i=1}$ be a chain, and suppose $ a = \bigvee_i a_i$. 
Note that 1 is trivial in all but the abstraction and $\texttt{fix}$ cases.\\
 \emph{Base Cases: } 
 \begin{itemize}
 % real number constants
 \item $e \in \{ \texttt{0}, \ \texttt{1}, \ \ldots \}$
 % boolean constants
 \item $e \in \{ \texttt{true}, \ \texttt{false} \}$\\ \\
 %
  In both of these cases, $\llbracket \Gamma \vdash e : \tau \rrbracket$ is a constant function from a $\Gamma$-environment
 $\eta$ to an element of $\llbracket \tau \rrbracket$, so clearly $\tmden{\typing\Gamma e\tau}{\extend\eta x {\bigvee_i a_i}} =
\bigvee_i\tmden{\typing\Gamma e\tau}{\extend\eta x {a_i}}$.

% variable
 \item $e = x : \tau$ \\ \\
 We want to show that $\tmden{\typing\Gamma x\tau}{\extend\eta y {\bigvee_i a_i}} =
\bigvee_i\tmden{\typing\Gamma x\tau}{\extend\eta y {a_i}}$.

In the case that $ y \neq x$, note that
\begin{align*}
\tmden{\typing\Gamma x\tau}{\extend\eta y {\bigvee_i a_i}} &= \eta\{y\mapsto \bigvee_i a_i\}(x) \\
&= \eta (x) \\
&= \bigvee_i\tmden{\typing\Gamma x\tau}{\extend\eta y {a_i}}
\end{align*}

 In the case that $y = x$, note that
  \begin{align*}
  \llbracket \Gamma \vdash x : \tau \rrbracket\eta\{y\mapsto\bigvee_i a_i\} &= \eta\{y\mapsto \bigvee_i a_i\}(x) \\
  &= \bigvee_i a_i \\
  &=\bigvee_i \eta\{y \mapsto a_i\}(x)  \\
  &= \bigvee_i\tmden{\typing\Gamma x\tau}{\extend\eta y {a_i}} \\
  \end{align*}
 \end{itemize}
 \emph{Inductive Cases: }
 \begin{itemize}
 % arithmetic operations
 \item $e = e_1 \circ e_2, \ \circ \in \{+, -, *, / \}$ \\ \\
 Then 
 \begin{align*}
 \llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x \mapsto \bigvee_i a_i\} &= \llbracket \Gamma\vdash e_1 : \tau 
 \rrbracket\eta\ \{x \mapsto \bigvee_i a_i\} \circ \llbracket \Gamma \vdash e_2 : \tau \rrbracket\eta\{x \mapsto \bigvee_i a_i\}\\
  \text{(by inductive hypothesis)} &=  \bigvee_i\llbracket \Gamma \vdash e_1: \tau \rrbracket\eta\{x\mapsto a_i\} \circ
  \bigvee_i\llbracket \Gamma \vdash e_2: \tau \rrbracket\eta\{x\mapsto a_i\}  \\
  &= \bigvee_i(\llbracket \Gamma \vdash e_1: \tau \rrbracket\eta\{x\mapsto a_i\} \circ 
  \llbracket \Gamma \vdash e_2: \tau \rrbracket\eta\{x\mapsto a_i\}) \\
  &= \bigvee_i \llbracket \Gamma \vdash e: \tau \rrbracket\eta\{x\mapsto a_i\}
 \end{align*}

  % equality operation
  \item $e = e_1 \circ e_2, \ \circ \in \{=,<,>,\leq,\geq\}$\\ \\
  In the case that 
 \begin{align*}
  \llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} &= \perp \\ 
  \text{or }  \llbracket \Gamma \vdash e_2 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} &= \perp,
  \end{align*} 
  note that $\llbracket \Gamma \vdash e : \texttt{bool}\rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = \perp$. 
  By inductive hypothesis, 
  \begin{align*}
  \llbracket \Gamma \vdash e_1 : \tau \rrbracket\{x\mapsto  \bigvee_i a_i\} &= \bigvee_i\llbracket \Gamma \vdash e_1 : \tau \rrbracket\{x\mapsto a_i\} \\
 \text{and } \llbracket \Gamma \vdash e_2 : \tau \rrbracket\{x\mapsto  \bigvee_i a_i\} &= \bigvee_i\llbracket \Gamma \vdash e_2 : \tau \rrbracket\{x\mapsto a_i\}, 
  \end{align*}
  so assuming WLOG that $\llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = \perp$, 
  it must be that for \\
  $\forall i, \llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto a_i\} = \perp$. 
  Thus, $\bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto a_i\} = \perp$, so \\
  $\bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto a_i\} = 
  \llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}$.\\ \\
  %
  In the case that $\llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} 
  \circ \llbracket \Gamma \vdash e_2 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}, \ 
  \llbracket \Gamma \vdash e_1:\tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} \neq \perp, 
  \llbracket \Gamma \vdash e_2 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} \neq \perp$, 
  note that $\llbracket \Gamma \vdash e : \texttt{bool}\rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = true$. 
 By inductive hypothesis, 
  \begin{align*}
  \llbracket \Gamma \vdash e_1 : \tau \rrbracket\{x\mapsto  \bigvee_i a_i\} &= \bigvee_i\llbracket \Gamma \vdash e_1 : \tau \rrbracket\{x\mapsto a_i\} \\
 \text{and } \llbracket \Gamma \vdash e_2 : \tau \rrbracket\{x\mapsto  \bigvee_i a_i\} &= \bigvee_i\llbracket \Gamma \vdash e_2 : \tau \rrbracket\{x\mapsto a_i\}, 
  \end{align*}
  so $\bigvee_i\llbracket \Gamma \vdash e_1 : \tau \rrbracket\{x\mapsto a_i\} 
  \circ \bigvee_i\llbracket \Gamma \vdash e_2 : \tau \rrbracket\{x\mapsto a_i\}$, with neither supremum equal to bottom. Thus there must $\exists n \in \mathbb{N} \text{ s.t. } \forall i \geq n, \llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto   a_i\} \circ
  \llbracket \Gamma \vdash e_2 : \tau \rrbracket\eta\{x\mapsto   a_i\}$. Therefore, $\bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  a_i\}\} = true$, so $\llbracket \Gamma \vdash e : \texttt{bool}\rrbracket\eta\{x\mapsto \bigvee_i a_i\} 
  = \bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  a_i\}$. \\ \\
  %
 In the case that $\llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} \ \slashed{\circ} \ \llbracket \Gamma \vdash e_2 : \tau\rrbracket\eta\{x\mapsto  \bigvee_i a_i\}, \ \\
 \llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} \neq \perp, 
 \llbracket \Gamma \vdash e_2 : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} \neq \perp$, by reasoning similar to the previous case see that $\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = 
 \bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  a_i\}$.
  % conditional
 \item $e = \ \ifelse{e_1}{e_2}{e_3} : \tau$ \\ \\
In the case that $\llbracket \Gamma \vdash e_1 : \texttt{bool} \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = \perp$, note that $\llbracket \Gamma \vdash e : 
\tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} =  \perp$. By inductive hypothesis, 
$\llbracket \Gamma \vdash e_1 : \texttt{bool} \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = 
\bigvee_i\llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto a_i\} = \perp$. 
Then it must be that for 
$\forall i, \llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto a_i\} = \perp$. 
Thus, $\bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  a_i\} = \perp$, so 
$\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = 
\bigvee_i\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}$. \\ \\
%
In the case that $\llbracket \Gamma \vdash e_1 : \texttt{bool} \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = true$, 
note that $\llbracket \Gamma \vdash e : 
\tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} =  \llbracket \Gamma \vdash e_2 \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}$. 
By inductive hypothesis, 
$\llbracket \Gamma \vdash e_1 : \texttt{bool} \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = 
\bigvee_i\llbracket \Gamma \vdash e_1 : \tau \rrbracket\eta\{x\mapsto a_i\} = true$. 
Since $\{a_i\}^{\infty}_{i=1}$ is a chain 
and $\llbracket\texttt{bool}\rrbracket$ is a flat CPO, there must exist $n \in \mathbb{N}$ such that 
$\forall i > n, \llbracket \Gamma \vdash e_1 : \texttt{bool}
\rrbracket\eta\{x\mapsto a_i\} = true$ and 
$\forall i \leq n, \llbracket \Gamma \vdash e_1 : \texttt{bool}\rrbracket\eta\{x\mapsto  a_i\} = \perp$. Thus, it must 
be that $\bigvee_i \llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto a_i\} = 
\llbracket \Gamma \vdash e_2 \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = 
\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}$. \\ \\
%
In the case that $\llbracket \Gamma \vdash e_1 : \texttt{bool} \rrbracket\eta\{x\mapsto  \bigvee_i a_i\} = false$, by reasoning parallel to the previous case $\bigvee_i \llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto a_i\}  = 
\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}$.
% application
 \item $ e = e_1 \ e_2$ \\ \\
Then
\begin{align*}
\llbracket \Gamma \vdash e : \tau \rrbracket\eta\{x \mapsto \bigvee_i a_i\} &=
\llbracket \Gamma \vdash e_1 : \sigma \rightarrow \tau \rrbracket\eta\{x \mapsto \bigvee_i a_i\}
(\llbracket \Gamma \vdash e_2 : \sigma \rrbracket\eta\{x \mapsto \bigvee_i a_i\}) \\
&= \llbracket \Gamma \vdash \lambda (y:\sigma).e' : \tau \rrbracket\eta\{x \mapsto \bigvee_i a_i\}
(\llbracket \Gamma \vdash e_2 : \sigma \rrbracket\eta\{x \mapsto \bigvee_i a_i\}) \\
\text{(by inductive hypothesis)} &= 
\llbracket \Gamma \vdash \lambda (y:\sigma).e' : \tau \rrbracket\eta\{x \mapsto \bigvee_i a_i\}
(\bigvee_i \llbracket \Gamma \vdash e_2 : \sigma \rrbracket\eta\{x \mapsto a_i\}) \\
&= \llbracket \Gamma. y : \sigma \vdash e' : \tau' \rrbracket\eta\{x \mapsto \bigvee_i a_i\}\{y \mapsto (\bigvee_i \llbracket 
\Gamma \vdash e_2 : \sigma \rrbracket\eta\{x \mapsto a_i\})\} \\
\text{(by inductive hypothesis)}&= \bigvee_i \llbracket \Gamma. y : \sigma \vdash e' : \tau' \rrbracket\eta\{x \mapsto 
a_i\}\{y \mapsto (\llbracket \Gamma \vdash e_2 : \sigma \rrbracket\eta\{x \mapsto a_i\})\} \\
&=\bigvee_i \llbracket \Gamma \vdash e_1: \sigma \rightarrow \tau\rrbracket\eta\{x\mapsto a_i\}
(\llbracket\Gamma\vdash e_2 : \sigma\rrbracket\eta\{x\mapsto a_i\}) \\
&= \bigvee_i \llbracket \Gamma \vdash e:\tau\rrbracket\eta\{ x \mapsto a_i\} \\
\end{align*}
 % abstraction
 \item $e = \lambda (y : \tau) . (e' : \tau')$
 \begin{enumerate}
 \item Then $\llbracket \Gamma \vdash e : \tau \rightarrow \tau' \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}$ i
 s a function $f: \llbracket \tau \rrbracket \rightarrow \llbracket \tau'  \rrbracket$ such that for 
 $\forall d \in \llbracket \tau \rrbracket, \ f(d) = \llbracket \Gamma y : \tau \vdash e' : \tau 
 \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}\{y \mapsto d\}$. We want to show that
 $\tmden{\typing\Gamma e\tau}{\extend\eta x {\bigvee_i a_i}} =
\bigvee_i\tmden{\typing\Gamma e\tau}{\extend\eta x {a_i}}$
 
Let $d \in \llbracket \tau \rrbracket$, and consider that
\begin{align*}
\llbracket \Gamma \vdash e : \tau \rightarrow \tau' \rrbracket\eta\{x\mapsto  \bigvee_i a_i\}(d) 
&= \llbracket \Gamma.y : \tau \vdash e' : \tau'\rrbracket\eta\{x\mapsto  \bigvee_i a_i\}
\{y \mapsto d\} \\
&= \llbracket \Gamma.y : \tau \vdash e' : \tau'\rrbracket(\eta\{y \mapsto d\})\{x\mapsto  \bigvee_i a_i\} \\
\text{(by inductive hypothesis)}&=\bigvee_i\llbracket \Gamma.y:\tau\vdash e':\tau'\rrbracket(\eta\{y\mapsto d\})
\{x\mapsto a_i\} \\
&=\bigvee_i\llbracket \Gamma.y:\tau\vdash e':\tau'\rrbracket(\eta\{x\mapsto a_i\})\{y\mapsto d\} \\
&= \bigvee_i \llbracket \Gamma \vdash \lambda y : \tau.e' : \tau' \rrbracket \eta\{x\mapsto a_i\}(d) \\
&= \bigvee_i \llbracket \Gamma \vdash e : \tau \rightarrow \tau' \rrbracket \eta\{x\mapsto a_i\}(d) \\ 
\end{align*}
%
 \item We want to show that $\llbracket \Gamma \vdash e : \tau \rightarrow \tau' \rrbracket\eta \in \llbracket \tau \rightarrow 
 \tau'\rrbracket$---that is, it is a continuous function from $\llbracket \tau \rrbracket$ to $\llbracket \tau' \rrbracket$. Let 
 $\{a_i\}^{\infty}_{i=1}$ be a chain of elements in $\llbracket \tau \rrbracket$, and see that
 \begin{align*}
 \llbracket \Gamma \vdash e : \tau \rightarrow \tau' \rrbracket\eta(\bigvee_i a_i) &= \llbracket \Gamma.x : \tau 
 \vdash e' : \tau'\rrbracket\eta \{x \mapsto \bigvee_i a_i\} \\
 \text{(by 1)} &= \bigvee_i \llbracket \Gamma.x : \tau \vdash e' : \tau'\rrbracket\eta\{x\mapsto a_i\}\\
 &= \bigvee_i \llbracket \Gamma \vdash e : \tau \rightarrow \tau' \rrbracket\eta(a_i) 
 \end{align*}
 \end{enumerate} 
 % fix operation
 \item $e = \texttt{fix} (\lambda f.\lambda x.e)$ \\
 \begin{enumerate}
\item Let $F_i = \llbracket \Gamma \vdash \lambda f. \lambda x.e\rrbracket\eta\{x\mapsto a_i\}$, and consider that 
 \begin{align*}
 \llbracket \texttt{fix} (\lambda f.\lambda x.e)\rrbracket\eta\{x\mapsto \bigvee_i a_i\} &= 
 fix(\llbracket \lambda f. \lambda x.e \rrbracket\eta\{x\mapsto \bigvee_i a_i\})\\
 \text{(by inductive hypothesis)} &= fix(\bigvee\{F_i\}^{\infty}_{i=1}) \\
 &= \bigvee\{\bigvee\{(F_i)^j \}^{\infty}_{i=1}\perp\}^{\infty}_{j=1} \\
 &= \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} \\ 
\text{(by \ref{lem1})} &= \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{j=1}\}^{\infty}_{i=1} \\ 
&= \bigvee\{fix(F_i)\}^{\infty}_{i=1}\\
&= \bigvee_i \llbracket \Gamma \vdash \texttt{fix}(\lambda f \lambda x.e)\rrbracket\eta\{x\mapsto a_i\}
 \end{align*}
 %
 \item Let $F = \llbracket \Gamma \vdash \lambda f. \lambda x.e\rrbracket\eta$. We want to show that 
 $\llbracket\Gamma\vdash\texttt{fix}(\lambda f \lambda x.e) : \tau 
 \rightarrow\tau\rrbracket\eta \in \llbracket \tau \rightarrow \tau \rrbracket$---that is, it is a continuous function from 
 $\llbracket \tau \rrbracket$ to $\llbracket \tau \rrbracket$. Let $\{a_i\}^{\infty}_{i=1}$ be a chain of elements in $\llbracket \tau \rrbracket$,
  and see that 
 \begin{align*}
 \llbracket\Gamma\vdash\texttt{fix}(\lambda f \lambda x.e) : \tau \rightarrow\tau\rrbracket\eta \bigvee_i a_i &= 
 fix(F)\bigvee_i a_i\\
 &=\bigvee\{F^j \perp\}^{\infty}_{j=1}\bigvee_i a_i\\
 &= \bigvee\{F^j \perp(\bigvee_i a_i)\}^{\infty}_{j=1}\\ 
 \text{(by continuity of $F^j \perp$) }&= \bigvee\{\bigvee\{F^j \perp(a_i)\}^{\infty}_{i=1}\}^{\infty}_{j=1}\\ 
 \text{(by \ref{lem2})} &=\bigvee\{\bigvee\{F^j \perp(a_i)\}^{\infty}_{j=1}\}^{\infty}_{i=1}\\
 &= \bigvee\{fix(F)(a_i)\}^{\infty}_{i=1}\\
 &= \bigvee\{\llbracket\Gamma\vdash\texttt{fix}(\lambda f \lambda x.e) : \tau \rightarrow\tau\rrbracket\eta(a_i)\}^{\infty}_{i=1}\\
 \end{align*}
 \end{enumerate}
 \end{itemize}
 \end{proof}
 % Lemmas
 \begin{lemma} $\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1}= \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}
 \label{lem1}
 _{j=1}\}^{\infty}_{i=1}$\\
 \end{lemma}
 \begin{proof}
 $\Rightarrow$ We want to show that\\ \\ \centerline{$\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}
 _{j=1} \geq  \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{j=1}\}^{\infty}_{i=1}$} \\ \\ First, notice that $\forall i, j \bigvee\{\bigvee
 \{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} \geq (F_i)^j$. \\
 Suppose, now, that 
 \begin{align*}
 &\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} < \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{j=1}\}^{\infty}_{i=1}\\ 
 \Rightarrow \exists i \text{ s.t. \ \  \ } &\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} < \bigvee\{(F_i)^j \perp\}
 ^{\infty}_{j=1}\\
 \Rightarrow \exists i, j \text{ s.t. } &\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} < (F_i)^j \perp 
 \Rightarrow\Leftarrow\\
 \end{align*}
 Thus, it must be that $\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} \geq  \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}
 _{j=1}\}^{\infty}_{i=1}$ \\ \\
 $\Leftarrow$ By parallel reasoning, $\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} \leq  \bigvee\{\bigvee\{(F_i)^j 
 \perp\}^{\infty}_{j=1}\}^{\infty}_{i=1}$ \\ \\
 Therefore, $\bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{i=1}\}^{\infty}_{j=1} = \bigvee\{\bigvee\{(F_i)^j \perp\}^{\infty}_{j=1}\}
 ^{\infty}_{i=1}$ \\ \\
 \end{proof}
 %
 \begin{lemma}
 \label{lem2}
 $\bigvee\{\bigvee\{F^j \perp(x_i)\}^{\infty}_{i=1}\}^{\infty}_{j=1} = \bigvee\{\bigvee\{F^j \perp(x_i)\}^{\infty}
 _{j=1}\}^{\infty}_{i=1}$\\ 
 \end{lemma}
 \begin{proof} 
 By reasoning similar to \ref{lem1}. \\ \\
 \end{proof}
 
\section{Examples}
Consider that we may express the general equation $T(x) = a(x) + T(m(x))$ in our expression language as follows:
 \begin{align*}
 \texttt{T} = \texttt{fix}(\lambda f. \lambda x.\texttt{a}(x) + f (\texttt{m}(x)))
 \end{align*}
 We want to show that the denotation of this expression has the same behavior as this deterministic function. First, let 
 $\texttt{F} = \lambda f. \lambda x.\texttt{a}(x) + f (\texttt{m}(x)$, and note the following:
 \begin{align*}
 \llbracket \texttt{T} \rrbracket &= fix(\llbracket \texttt{F} \rrbracket) \\
 \llbracket \texttt{F} \rrbracket &= F : \llbracket \texttt{real} \rightarrow \texttt{real}\rrbracket \rightarrow \llbracket \texttt{real} \rightarrow 
 \texttt{real}\rrbracket \\ &\text{ \ \ \ s.t. } \forall \alpha \in \llbracket \texttt{real}\rrbracket \rightarrow \llbracket \texttt{real}
 \rrbracket, \ 
 F(\alpha) = \llbracket \lambda x.a + f (p * x)\rrbracket\{f \mapsto \alpha\} \\
 \llbracket \texttt{real}\rrbracket &= \R_{[0, +\infty]}  
 \\\text{By the CPO fixpoint theorem, } fix(\llbracket \texttt{F} \rrbracket) &= fix(F) \\
&= \bigvee\{F^n (\perp)\}^{\infty}_{n=1} \\
&= \lim_{n \to \infty}\{F^n (\perp)\}
 \end{align*}
 Recall that the bottom element of $\llbracket \texttt{real} \rrbracket$ is $0$, so the bottom element of $\llbracket \texttt{real} 
 \rightarrow \texttt{real}\rrbracket$ is the function $\perp$ that maps every element in $\llbracket \texttt{real} \rrbracket$ to 
 $0$.  \\
 %
 \begin{lemma}
 \label{lem2}
 \begin{align*}
 \forall d \in \R_{[0, +\infty]}, \ F^n(\perp)(d) = \sum_{i = 0}^{n-1}a(m^{i}(d))
 \end{align*}
 \end{lemma}
 %
 \begin{proof} by induction on n. \\
 \emph{Base case:} n = 1
 \begin{align*}
 \forall d \in \extR, \ F(\perp)(d) &= \llbracket \lambda x.\texttt{a}(x) + f (\texttt{m}(x))\rrbracket\{f \mapsto \perp, x \mapsto d\} \\
 &= a(d) + \perp(m(d)) \\
 &= a(d)  \\
 \end{align*}
 \emph{Inductive case:} Suppose the claim hold for $\forall k < n$.
 \begin{align*}
 \forall d \in \extR, \ F^n(\perp)(d) &= \llbracket \lambda x.\texttt{a}(x) + f (\texttt{m}(x))\rrbracket
 \{f \mapsto F^{n-1}(\perp),x\mapsto d\} \\
 &= a(d) + F^{n-1}(\perp)(m(d)) \\
\text{(by inductive hypothesis)} &= a(d) 
					    + \sum_{i = 0}^{n-2}a(m^{i}(m(d))) \\
&= a(d) + \sum_{i = 0}^{n-2} a( m^{i+1}d) \\
&= \sum_{i=0}^{n-1} a(m^{i}d) \\
\end{align*}
\end{proof}
Therefore, 
\begin{thm}
\begin{align*}
\forall d \in \extR, \ \llbracket \texttt{T} \rrbracket\{x \mapsto d\} &= \lim_{n \to \infty}\{F^n (\perp)\}(d) \\
&= \sum_{i=0}^{\infty}a(m^{i}(d)) \\
 \end{align*}
 \end{thm}
 
\subsection{Example 1}
Consider the simple example Karp offers, wherein $m(x) = px$, with $p$ a positive constant less than 1, and $a(x) = 0, \ x < 1, 
\ a(x) = 1, \ x \geq 1$. Then $T(x) = a(x) + T(px)$, so by a simple inductive argument we can show that 
\begin{align*}
T(x) &= 
 \begin{cases}
 0 \text{ if } x < 1 \\
 k \text{ if }  \dfrac{1}{p^{k-1}} \leq x < \dfrac{1}{p^k} \\
 \end{cases}
 \end{align*}
We may express this function in our expression language using the expression $\texttt{T}$ defined above, with 
$\texttt{a}(x) = \ifelse{x<1}{0}{1}$ and $\texttt{m}(x) = p*x$:
 \begin{align*}
 \texttt{fix}(\lambda f. \lambda x. (\ifelse{x<1}{0}{1}) + f (p * x))
 \end{align*}
 Then, by theorem 6,
 \begin{align*}
 \forall d \in \extR, \llbracket \texttt{T} \rrbracket\{x \mapsto d\} = \sum_{i=0}^{\infty}a(p^{i}d)
 \end{align*}
We must verify that $\llbracket \texttt{T} \rrbracket$ has the same behavior as the function $T$ described by Karp.
Note that for $\forall d \in \extR, \ \exists k \in \N$  s.t. $\dfrac{1}{p^{k-1}} \leq d < \dfrac{1}{p^k}$, so $T(d) = k$. Also, 
for $\forall i < k, \ p^id \geq 1$, and for $\forall i \geq k, p^id < 1$. Note, then, that
\begin{align*}
\llbracket \texttt{T} \rrbracket\{x\mapsto d\} &= \sum_{i=0}^{k} a(p^{i}d) + \sum_{i=k+1}^{\infty} a(p^{i}d) \\
&= \sum_{i=0}^{k} 1 + \sum_{i=k+1}^{\infty} 0\\
&= k \\
&= T(d) \\
\end{align*}
Thus, $\llbracket \texttt{T} \rrbracket = T$.

\subsection{Example 2}
Let $m(x) = px$, where $p$ is a positive constant less than 1, and $a(x) = x$. Then $T(x) = x + T(px)$, so, for instance,
\begin{align*}
T(1) = 1 + p + p^2 + p^3 + \ldots
\end{align*}
See, then, that this function describes the following geometric series:
\begin{align*}
T(x) &= \sum_{i=0}^{\infty} p^ix \\ 
&= \frac{x}{1 - p} \ (\text{since } 0 \leq p \leq 1)
\end{align*}
We may express this function in our expression language using the expression $\texttt{T}$ defined above, with 
$\texttt{a}(x) = x$ and $\texttt{m}(x) = p*x$:
\begin{align*}
 \texttt{T} = \texttt{fix}(\lambda f. \lambda x.x + f (p * x))
 \end{align*}
Then, by theorem 6,
 \begin{align*}
 \forall d \in \extR, \llbracket \texttt{T} \rrbracket\{x \mapsto d\} = \sum_{i=0}^{\infty}p^{i}d
 \end{align*}
See, then, that for $\forall d \in \extR, \ T(d) = \sum_{i=0}^{\infty}p^{i}d = \llbracket \texttt{T} \rrbracket \{x \mapsto d\}$.
Thus, $\llbracket \texttt{T} \rrbracket$ has the same behavior as the function $T$ described by Karp.
 
 \subsection{Example 3} Let $m(x) = x$ and $a(x) = x$. Then $m(x), a(x)$, and $m(x)/x$ are all non-decreasing functions and 
 thus meet the assumptions specified by Karp. Note that $T(x) = x + T(x)$, so, for instance,
\begin{align*}
T(1) = 1 + 1 + 1 + \ldots
\end{align*}
See, then, that this function describes the following series:
\begin{align*}
T(x) &= \sum_{i=0}^{\infty} x 
\end{align*}
Clearly this series diverges for $\forall x \in \R$. We may express this function in our expression language using the 
expression $\texttt{T}$ defined above, with $\texttt{a}(x) = x$ and $\texttt{m}(x) = x$:
\begin{align*}
 \texttt{T} = \texttt{fix}(\lambda f. \lambda x.x + f (x))
 \end{align*}
Then, by theorem 6,
 \begin{align*}
 \forall d \in \extR, \llbracket \texttt{T} \rrbracket\{x \mapsto d\} = \sum_{i=0}^{\infty}d
 \end{align*}
See, then, that for $\forall d \in \extR, \ T(d) = \sum_{i=0}^{\infty}d = \llbracket \texttt{T} \rrbracket\{x \mapsto d\}$.
Thus, $\llbracket \texttt{T} \rrbracket$ has the same behavior as the function $T$ described by Karp.


